<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Practice Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .json-input-section {
            background: #f8f9fa;
            padding: 30px;
            border-bottom: 2px solid #e9ecef;
        }

        .json-input-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
        }

        .json-textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .json-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .timer-section {
            background: #2c3e50;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #34495e;
        }

        .timer-display {
            font-size: 1.4em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
        }

        .timer-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .timer-btn:hover {
            background: #2980b9;
        }

        .timer-btn.pause {
            background: #e74c3c;
        }

        .timer-btn.pause:hover {
            background: #c0392b;
        }

        .timer-btn.resume {
            background: #27ae60;
        }

        .timer-btn.resume:hover {
            background: #229954;
        }

        .pause-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .pause-message {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 400px;
        }

        .pause-message h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .pause-message p {
            color: #6c757d;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .final-time {
            background: #e8f5e8;
            border: 2px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .final-time h3 {
            color: #155724;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .final-time .time-display {
            font-size: 1.8em;
            font-weight: bold;
            color: #28a745;
            font-family: 'Courier New', monospace;
        }

        .sample-format {
            margin-top: 20px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9em;
            border-left: 4px solid #2196f3;
        }

        .sample-format strong {
            color: #1976d2;
            display: block;
            margin-bottom: 10px;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }

        .question-container {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .question {
            margin-bottom: 35px;
            padding: 25px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .question:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .question.answered {
            border-color: #28a745;
            background: #f8fff9;
        }

        .question.correct-answer {
            border-color: #28a745;
            background: #d4edda;
            border-width: 3px;
        }

        .question.incorrect-answer {
            border-color: #dc3545;
            background: #f8d7da;
            border-width: 3px;
        }

        .question.unattempted-answer {
            border-color: #6c757d;
            background: #f8f9fa;
            border-width: 3px;
        }

        .question-number {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
            accent-color: #667eea;
        }

        .option label {
            cursor: pointer;
            font-size: 1em;
            line-height: 1.4;
            flex: 1;
        }

        .option.selected {
            background: #e8f4f8;
            border-color: #667eea;
        }

        .option.correct {
            background: #d4edda !important;
            border-color: #28a745 !important;
            border-width: 2px;
        }

        .option.incorrect {
            background: #f8d7da !important;
            border-color: #dc3545 !important;
            border-width: 2px;
        }

        .option.user-selected {
            background: #fff3cd !important;
            border-color: #ffc107 !important;
            border-width: 2px;
        }

        .answer-indicator {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            font-size: 0.9em;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .answer-indicator.correct {
            background: #28a745;
            color: white;
        }

        .answer-indicator.incorrect {
            background: #dc3545;
            color: white;
        }

        .answer-indicator.user {
            background: #ffc107;
            color: #212529;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
            text-align: center;
        }

        .results {
            display: none;
            padding: 40px;
            text-align: center;
        }

        .results.show {
            display: block;
        }

        .results h2 {
            font-size: 2.5em;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-card {
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            color: white;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .result-correct {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .result-incorrect {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }

        .result-unattempted {
            background: linear-gradient(135deg, #6c757d, #adb5bd);
        }

        .result-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .result-label {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .percentage {
            font-size: 1.8em;
            font-weight: bold;
            margin: 20px 0;
            color: #2c3e50;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #6c757d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px;
            border: 1px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px;
            border: 1px solid #c3e6cb;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .json-input-section {
                padding: 20px;
            }
            
            .question-container {
                padding: 20px;
            }
            
            .question {
                padding: 20px;
            }
            
            .controls {
                padding: 20px;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 1em;
                margin: 5px;
            }

            .input-controls {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Add print-specific styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .container, .container * {
                visibility: visible;
            }
            .container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .json-input-section,
            .timer-section,
            .stats-bar,
            .controls,
            .pause-overlay,
            .no-print,
            .print-options {
                display: none !important;
            }
            .results {
                display: block !important;
                visibility: visible !important;
            }
            .results.hidden {
                display: block !important;
                visibility: visible !important;
            }
            .question-review {
                page-break-inside: avoid;
                margin: 20px 0;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
            }
            .print-only {
                display: block !important;
            }
        }
        .print-only {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Online Practice Test</h1>
            <p>Test Your Knowledge with Timed Practice</p>
        </div>

        <div class="json-input-section" id="json-input-section">
            <h3>Enter Questions JSON Data</h3>
            <div class="input-controls" style="margin-bottom: 20px;">
                <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="loadFromFile(event)">
                <button class="btn btn-secondary" onclick="document.getElementById('jsonFileInput').click()">Load from File</button>
            </div>
            <textarea 
                id="jsonTextarea" 
                class="json-textarea" 
                placeholder="Paste your JSON data here..."
            ></textarea>
            
            <div class="input-controls">
                <button class="btn btn-success" onclick="loadFromTextarea()">Load Questions</button>
                <button class="btn btn-secondary" onclick="clearTextarea()">Clear</button>
                <button class="btn btn-secondary" onclick="loadSampleData()">Load Sample</button>
            </div>
            
            <div class="sample-format">
                <strong>JSON Format Example:</strong>
                {<br>
                &nbsp;&nbsp;"questions": [<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"id": 1,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"question": "Your question text here?",<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"options": {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"A": "Option A text",<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"B": "Option B text",<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"C": "Option C text",<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"D": "Option D text"<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"correct_answer": "A"<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;]<br>
                }
            </div>
        </div>

        <div class="timer-section hidden" id="timer-section">
            <div class="timer-display" id="timer-display">00:00:00</div>
            <div class="timer-controls">
                <button class="timer-btn pause" id="pause-btn" onclick="toggleTimer()">Pause</button>
            </div>
        </div>
        <div class="stats-bar hidden" id="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="total-questions">0</div>
                <div class="stat-label">Total Questions</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="answered-count">0</div>
                <div class="stat-label">Answered</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="remaining-count">0</div>
                <div class="stat-label">Remaining</div>
            </div>
        </div>

        <div id="quiz-container" class="hidden">
            <div class="question-container" id="questions-container">
                <!-- Questions will be loaded dynamically -->
            </div>

            <div class="controls">
                <button class="btn" id="submit-btn" onclick="submitQuiz()">Submit Quiz</button>
                <button class="btn btn-secondary" onclick="resetQuiz()">Reset Quiz</button>
            </div>
        </div>

        <div class="results hidden" id="results">
            <h2>Quiz Results</h2>
            <div class="final-time" id="final-time-display">
                <h3>Total Time Taken</h3>
                <div class="time-display" id="final-time">00:00:00</div>
            </div>
            <div class="percentage" id="percentage"></div>
            <div class="result-grid">
                <div class="result-card result-correct">
                    <div class="result-number" id="correct-count">0</div>
                    <div class="result-label">Correct</div>
                </div>
                <div class="result-card result-incorrect">
                    <div class="result-number" id="incorrect-count">0</div>
                    <div class="result-label">Incorrect</div>
                </div>
                <div class="result-card result-unattempted">
                    <div class="result-number" id="unattempted-count">0</div>
                    <div class="result-label">Unattempted</div>
                </div>
            </div>
            <div class="print-options" style="margin: 20px 0; text-align: center;">
                <h3>Print Options</h3>
                <div class="input-controls">
                    <button class="btn" onclick="printResults(false)">Print Summary Only</button>
                    <button class="btn" onclick="printResults(true)">Print with Questions & Answers</button>
                </div>
            </div>
            <div id="print-content" class="print-only"></div>
            <div class="controls">
                <button class="btn" onclick="showAnswerReview()">Review Answers</button>
                <button class="btn btn-secondary" onclick="resetQuiz()">Take Again</button>
            </div>
        </div>

        <div class="loading hidden" id="loading">
            Loading questions...
        </div>

        <!-- Pause Overlay -->
        <div class="pause-overlay hidden" id="pause-overlay">
            <div class="pause-message">
                <h3>Test Paused</h3>
                <p>Your test is currently paused. The timer has stopped and questions are hidden for security. Click resume to continue.</p>
                <button class="btn timer-btn resume" onclick="toggleTimer()">Resume Test</button>
            </div>
        </div>
    </div>

    <script>
        let questionsData = null;
        let userAnswers = {};
        let quizSubmitted = false;
        let totalQuestions = 0;
        let startTime = null;
        let elapsedTime = 0;
        let timerInterval = null;
        let isPaused = false;

        // Timer functions
        function startTimer() {
            if (!startTime) {
                startTime = Date.now() - elapsedTime;
            }
            
            timerInterval = setInterval(updateTimerDisplay, 1000);
            isPaused = false;
            
            document.getElementById('timer-section').classList.remove('hidden');
            document.getElementById('pause-btn').textContent = 'Pause';
            document.getElementById('pause-btn').className = 'timer-btn pause';
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimerDisplay() {
            if (!isPaused && startTime) {
                elapsedTime = Date.now() - startTime;
                const timeString = formatTime(elapsedTime);
                document.getElementById('timer-display').textContent = timeString;
            }
        }

        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function toggleTimer() {
            if (isPaused) {
                // Resume
                isPaused = false;
                startTime = Date.now() - elapsedTime;
                timerInterval = setInterval(updateTimerDisplay, 1000);
                
                document.getElementById('pause-overlay').classList.add('hidden');
                document.getElementById('pause-btn').textContent = 'Pause';
                document.getElementById('pause-btn').className = 'timer-btn pause';
            } else {
                // Pause
                isPaused = true;
                stopTimer();
                
                document.getElementById('pause-overlay').classList.remove('hidden');
                document.getElementById('pause-btn').textContent = 'Resume';
                document.getElementById('pause-btn').className = 'timer-btn resume';
            }
        }

        function resetTimer() {
            stopTimer();
            startTime = null;
            elapsedTime = 0;
            isPaused = false;
            document.getElementById('timer-display').textContent = '00:00:00';
            document.getElementById('timer-section').classList.add('hidden');
            document.getElementById('pause-overlay').classList.add('hidden');
        }
        // Load questions from textarea
        function loadFromTextarea() {
            const textarea = document.getElementById('jsonTextarea');
            const jsonText = textarea.value.trim();
            
            if (!jsonText) {
                showError('Please enter JSON data in the textarea.');
                return;
            }
            
            showLoading();
            
            try {
                const jsonData = JSON.parse(jsonText);
                if (validateJSONStructure(jsonData)) {
                    questionsData = jsonData;
                    loadQuestions();
                    hideJsonInput();
                    showQuizContainer();
                    showSuccess('Questions loaded successfully!');
                    startTimer(); // Start timer when questions are loaded
                } else {
                    showError('Invalid JSON structure. Please check the format.');
                }
            } catch (error) {
                showError('Invalid JSON format. Please check your syntax: ' + error.message);
            }
            
            hideLoading();
        }

        // Clear textarea
        function clearTextarea() {
            document.getElementById('jsonTextarea').value = '';
        }

        // Load sample data
        function loadSampleData() {
            const sampleData = {
                "questions": [
                    {
                        "id": 1,
                        "question": "What is the capital of India?",
                        "options": {
                            "A": "Mumbai",
                            "B": "New Delhi",
                            "C": "Kolkata", 
                            "D": "Chennai"
                        },
                        "correct_answer": "B"
                    },
                    {
                        "id": 2,
                        "question": "Which planet is known as the Red Planet?",
                        "options": {
                            "A": "Venus",
                            "B": "Jupiter",
                            "C": "Mars",
                            "D": "Saturn"
                        },
                        "correct_answer": "C"
                    },
                    {
                        "id": 3,
                        "question": "What is 15 + 25?",
                        "options": {
                            "A": "35",
                            "B": "40",
                            "C": "45",
                            "D": "50"
                        },
                        "correct_answer": "B"
                    }
                ]
            };
            
            document.getElementById('jsonTextarea').value = JSON.stringify(sampleData, null, 2);
        }

        function validateJSONStructure(data) {
            if (!data.questions || !Array.isArray(data.questions)) {
                return false;
            }
            
            for (let question of data.questions) {
                if (!question.id || !question.question || !question.options || !question.correct_answer) {
                    return false;
                }
                
                if (typeof question.options !== 'object' || 
                    !question.options.A || !question.options.B || 
                    !question.options.C || !question.options.D) {
                    return false;
                }
            }
            return true;
        }

        function loadQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            totalQuestions = questionsData.questions.length;
            document.getElementById('total-questions').textContent = totalQuestions;
            
            questionsData.questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.setAttribute('data-question', q.id);
                
                questionDiv.innerHTML = `
                    <div class="question-number">Question ${index + 1}:</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options">
                        <div class="option">
                            <input type="radio" name="q${q.id}" value="A" id="q${q.id}a">
                            <label for="q${q.id}a">${q.options.A}</label>
                        </div>
                        <div class="option">
                            <input type="radio" name="q${q.id}" value="B" id="q${q.id}b">
                            <label for="q${q.id}b">${q.options.B}</label>
                        </div>
                        <div class="option">
                            <input type="radio" name="q${q.id}" value="C" id="q${q.id}c">
                            <label for="q${q.id}c">${q.options.C}</label>
                        </div>
                        <div class="option">
                            <input type="radio" name="q${q.id}" value="D" id="q${q.id}d">
                            <label for="q${q.id}d">${q.options.D}</label>
                        </div>
                    </div>
                `;
                
                container.appendChild(questionDiv);
            });
            
            // Add event listeners for radio buttons
            container.addEventListener('change', function(e) {
                if (e.target.type === 'radio' && !quizSubmitted) {
                    const questionName = e.target.name;
                    userAnswers[questionName] = e.target.value;
                    
                    // Mark question as answered
                    const questionDiv = e.target.closest('.question');
                    questionDiv.classList.add('answered');
                    
                    // Update option styling
                    const options = questionDiv.querySelectorAll('.option');
                    options.forEach(option => option.classList.remove('selected'));
                    e.target.closest('.option').classList.add('selected');
                    
                    updateStats();
                }
            });
            
            updateStats();
        }

        function updateStats() {
            const answeredCount = Object.keys(userAnswers).length;
            const remainingCount = totalQuestions - answeredCount;
            
            document.getElementById('answered-count').textContent = answeredCount;
            document.getElementById('remaining-count').textContent = remainingCount;
        }

        function submitQuiz() {
            if (Object.keys(userAnswers).length === 0) {
                alert('Please answer at least one question before submitting.');
                return;
            }

            // Stop timer and calculate final time
            stopTimer();
            const finalTime = formatTime(elapsedTime);
            document.getElementById('final-time').textContent = finalTime;

            quizSubmitted = true;
            document.getElementById('submit-btn').disabled = true;
            
            const result = calculateResults();
            displayResults(result);
        }

        function calculateResults() {
            let correct = 0;
            let incorrect = 0;
            let unattempted = 0;

            questionsData.questions.forEach(q => {
                const questionKey = `q${q.id}`;
                if (userAnswers[questionKey]) {
                    if (userAnswers[questionKey] === q.correct_answer) {
                        correct++;
                    } else {
                        incorrect++;
                    }
                } else {
                    unattempted++;
                }
            });

            return { correct, incorrect, unattempted };
        }

        function displayResults(result) {
            const percentage = Math.round((result.correct / totalQuestions) * 100);
            
            document.getElementById('correct-count').textContent = result.correct;
            document.getElementById('incorrect-count').textContent = result.incorrect;
            document.getElementById('unattempted-count').textContent = result.unattempted;
            document.getElementById('percentage').textContent = `${percentage}% Correct`;
            
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('results').classList.add('show');
            document.getElementById('results').classList.remove('hidden');
        }

        function showAnswerReview() {
            document.getElementById('results').classList.remove('show');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            
            // Show answer indicators
            questionsData.questions.forEach(q => {
                const questionDiv = document.querySelector(`[data-question="${q.id}"]`);
                const questionKey = `q${q.id}`;
                const userAnswer = userAnswers[questionKey];
                const correctAnswer = q.correct_answer;
                
                // Reset question styling
                questionDiv.classList.remove('correct-answer', 'incorrect-answer', 'unattempted-answer');
                
                // Style question based on result
                if (!userAnswer) {
                    questionDiv.classList.add('unattempted-answer');
                } else if (userAnswer === correctAnswer) {
                    questionDiv.classList.add('correct-answer');
                } else {
                    questionDiv.classList.add('incorrect-answer');
                }
                
                // Style options
                const options = questionDiv.querySelectorAll('.option');
                options.forEach(option => {
                    const optionValue = option.querySelector('input').value;
                    const indicator = option.querySelector('.answer-indicator');
                    
                    // Remove existing indicators
                    if (indicator) {
                        indicator.remove();
                    }
                    
                    // Remove existing classes
                    option.classList.remove('correct', 'incorrect', 'user-selected');
                    
                    // Add correct answer styling
                    if (optionValue === correctAnswer) {
                        option.classList.add('correct');
                        const correctIndicator = document.createElement('div');
                        correctIndicator.className = 'answer-indicator correct';
                        correctIndicator.textContent = 'Correct';
                        option.appendChild(correctIndicator);
                    }
                    
                    // Add user answer styling (if different from correct)
                    if (userAnswer && optionValue === userAnswer && userAnswer !== correctAnswer) {
                        option.classList.add('user-selected');
                        const userIndicator = document.createElement('div');
                        userIndicator.className = 'answer-indicator user';
                        userIndicator.textContent = 'Your Answer';
                        option.appendChild(userIndicator);
                    }
                });
            });
            
            // Disable further changes
            const radios = document.querySelectorAll('input[type="radio"]');
            radios.forEach(radio => {
                radio.disabled = true;
            });
        }

        function resetQuiz() {
            // Reset all variables
            userAnswers = {};
            quizSubmitted = false;
            
            // Reset timer
            resetTimer();
            
            // Enable submit button
            document.getElementById('submit-btn').disabled = false;
            
            // Clear all radio button selections
            const radios = document.querySelectorAll('input[type="radio"]');
            radios.forEach(radio => {
                radio.checked = false;
                radio.disabled = false;
            });
            
            // Remove styling from questions and options
            const questions = document.querySelectorAll('.question');
            questions.forEach(question => {
                question.classList.remove('answered', 'correct-answer', 'incorrect-answer', 'unattempted-answer');
            });
            
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect', 'user-selected');
                const indicator = option.querySelector('.answer-indicator');
                if (indicator) {
                    indicator.remove();
                }
            });
            
            // Reset stats
            updateStats();
            
            // Show appropriate containers
            if (questionsData) {
                showQuizContainer();
                document.getElementById('results').classList.remove('show');
                document.getElementById('results').classList.add('hidden');
                startTimer(); // Restart timer for new attempt
            } else {
                showJsonInput();
                hideQuizContainer();
            }
            
            // Scroll to top
            const questionContainer = document.querySelector('.question-container');
            if (questionContainer) {
                questionContainer.scrollTop = 0;
            }
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showError(message) {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.error, .success');
            existingMessages.forEach(msg => msg.remove());
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.getElementById('stats-bar'));
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        function showSuccess(message) {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.error, .success');
            existingMessages.forEach(msg => msg.remove());
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.querySelector('.container').insertBefore(successDiv, document.getElementById('stats-bar'));
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
            }, 3000);
        }

        function hideJsonInput() {
            document.getElementById('json-input-section').classList.add('hidden');
        }

        function showJsonInput() {
            document.getElementById('json-input-section').classList.remove('hidden');
        }

        function showQuizContainer() {
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('stats-bar').classList.remove('hidden');
        }

        function hideQuizContainer() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('stats-bar').classList.add('hidden');
        }

        // Add new function to load questions from file
        function loadFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            showLoading();
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    if (validateJSONStructure(jsonData)) {
                        questionsData = jsonData;
                        totalQuestions = questionsData.questions.length;
                        showSuccess('Questions loaded successfully from file!');
                        hideJsonInput();
                        showQuizContainer();
                        loadQuestions();
                        startTimer();
                    } else {
                        showError('Invalid questions format in file. Please check the JSON structure.');
                    }
                } catch (error) {
                    showError('Error reading file. Please ensure it contains valid JSON data.');
                }
                hideLoading();
            };
            reader.onerror = function() {
                showError('Error reading file. Please try again.');
                hideLoading();
            };
            reader.readAsText(file);
        }

        // Update print function to print from current page
        function printResults(includeQuestions) {
            const printContent = document.getElementById('print-content');
            const result = calculateResults();
            
            // Clear previous content
            printContent.innerHTML = '';
            
            if (includeQuestions) {
                const questionsReview = document.createElement('div');
                questionsReview.className = 'questions-review';
                
                questionsData.questions.forEach(q => {
                    const questionKey = `q${q.id}`;
                    const userAnswer = userAnswers[questionKey];
                    const status = !userAnswer ? 'unattempted' : 
                                 userAnswer === q.correct_answer ? 'correct' : 'incorrect';
                    
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-review';
                    questionDiv.innerHTML = `
                        <h3>Question ${q.id}</h3>
                        <p>${q.question}</p>
                        <div class="options">
                            ${Object.entries(q.options).map(([key, value]) => `
                                <div class="${key === q.correct_answer ? 'correct' : 
                                           userAnswer === key ? 'user-selected' : ''}">
                                    ${key}: ${value}
                                    ${key === q.correct_answer ? ' (Correct)' : ''}
                                    ${userAnswer === key && key !== q.correct_answer ? ' (Your Answer)' : ''}
                                </div>
                            `).join('')}
                        </div>
                        <p class="${status}">Status: ${status.charAt(0).toUpperCase() + status.slice(1)}</p>
                    `;
                    questionsReview.appendChild(questionDiv);
                });
                
                printContent.appendChild(questionsReview);
            }
            
            // Show the results section if it's hidden
            document.getElementById('results').classList.remove('hidden');
            
            // Trigger print
            window.print();
            
            // Hide the print content after printing
            if (!includeQuestions) {
                printContent.innerHTML = '';
            }
        }
    </script>
</body>
</html>